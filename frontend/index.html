<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>ConRumbo &mdash; Asistente de Emergencias (MVP)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
  <script src="./script.js" defer></script>
</head>
<body>
  <main class="app-shell">
    <header class="topbar">
      <span class="brand" data-i18n="top.brand">ConRumbo</span>
      <nav class="topbar__actions">
        <button id="btnManual" type="button" class="icon-button" data-i18n="top.manual">Manual</button>
        <button id="btnSettings" type="button" class="icon-button" data-i18n="top.settings">Ajustes</button>
      </nav>
    </header>

    <section class="intro">
      <h1 data-i18n="intro.heading" data-i18n-mode="html">Mant&#233;n la calma.<br>Te guiar&#233; paso a paso.</h1>
      <p id="status" class="intro__status" data-i18n="intro.status">Inicializando...</p>
    </section>

    <section class="card mic-card">
      <button id="btnIniciar" type="button" class="mic-card__button">
        <span class="mic-card__icon" aria-hidden="true">
          <svg class="mic-card__icon-svg" width="26" height="26" viewBox="0 0 24 24" fill="none" focusable="false">
            <rect x="9" y="4" width="6" height="10" rx="3" fill="currentColor"></rect>
            <path d="M5 11a1 1 0 112 0 5 5 0 0010 0 1 1 0 112 0 7 7 0 01-6 6.9V21h2a1 1 0 110 2H9a1 1 0 110-2h2v-3.1A7 7 0 015 11z" fill="currentColor"></path>
          </svg>
        </span>
        <span class="mic-card__label" data-i18n="mic.buttonText">Iniciar</span>
      </button>
      <div id="manualInput" style="margin-top:12px; display:flex; gap:8px;">
        <input id="manualText" type="text" placeholder="Describe la situación…" style="flex:1;padding:.6rem;border-radius:10px;">
        <button id="sendManual" type="button" class="btn">Enviar</button>
      </div>
      <div class="mic-card__content">
        <h2 data-i18n="mic.subtitle">Estoy aqu&#237; para ayudarte. &#191;Cu&#225;l es la situaci&#243;n?</h2>
        <p class="mic-card__subtitle" data-i18n="mic.role">ConRumbo Bot</p>
        <div class="mic-card__transcription">
          <span class="mic-card__transcription-label" data-i18n="mic.transcriptionTitle">Transcripci&#243;n en vivo</span>
          <p id="transcripcion" class="mic-card__live-text">&mdash;</p>
        </div>
      </div>
    </section>

    <section class="card vitals-card">
      <div class="vitals-card__main">
        <div class="vitals-card__badges">
          <span class="vital-chip vital-chip--heart">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">82 bpm</span>
          </span>
          <span class="vital-chip vital-chip--breath">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">18 rpm</span>
          </span>
        </div>
        <div class="vitals-card__portrait" role="img" aria-label="Paciente escaneada"></div>
      </div>
      <div class="vitals-card__footer">
        <span class="status-pill status-pill--alert" data-i18n="vitals.alert">Herida detectada</span>
        <span class="status-pill status-pill--neutral" data-i18n="vitals.neutral">Scanner 3D activo</span>
      </div>
    </section>

    <section class="card steps-card">
      <header class="steps-card__header">
        <h2 data-i18n="steps.header">Instrucciones recientes</h2>
        <button id="btnCallTest" type="button" class="cta-secondary" data-i18n="steps.testCall">Llamar TEST (689876686)</button>
      </header>
      <ul id="instrucciones" class="steps-list"></ul>
    </section>
  </main>

  <footer class="app-footer">
    <a id="btnCall112" class="cta-primary" href="tel:112">
      <span class="cta-primary__icon" aria-hidden="true"></span>
      <span class="cta-primary__label" data-i18n="footer.call112">Llamar al 112</span>
    </a>
    <p class="disclaimer" data-i18n="footer.disclaimer">Este MVP no sustituye asistencia m&#233;dica profesional. Llama al 112 ante cualquier duda.</p>
  </footer>

  <div id="callModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal__content">
      <button id="modalClose" class="modal__close" aria-label="Cerrar" data-i18n-aria="modal.closeLabel">&times;</button>
      <h2 id="modalTitle" data-i18n="callModal.title">Llamada de Emergencia</h2>
      <p class="modal__number" id="modalNumber">112</p>
      <div class="modal__actions">
        <button id="copyNumber" type="button" data-i18n="callModal.copy">Copiar n&#250;mero</button>
        <a id="modalTelLink" class="modal__tel" href="tel:112" data-i18n="callModal.openDialer">Abrir marcador</a>
      </div>
      <canvas id="qrCanvas" class="modal__qr" aria-hidden="true"></canvas>
      <p class="modal__hint" data-i18n="callModal.hint">Escanea el c&#243;digo QR con tu m&#243;vil para llamar r&#225;pidamente.</p>
    </div>
  </div>

  <div id="manualModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="manualModalTitle">
    <div class="modal__content manual-modal">
      <button id="manualModalClose" class="modal__close" aria-label="Cerrar" data-i18n-aria="modal.closeLabel">&times;</button>
      <div class="manual-modal__header">
        <h2 id="manualModalTitle" data-i18n="manual.title">Manual de maniobras</h2>
        <p class="manual-modal__subtitle" data-i18n="manual.subtitle">Selecciona una maniobra para ver los pasos.</p>
      </div>
      <div class="manual-modal__body">
        <nav class="manual-list" id="manualList" aria-label="Lecciones"></nav>
        <article class="manual-detail" id="manualDetail">
          <h3 class="manual-detail__title" id="manualLessonTitle">—</h3>
          <p class="manual-detail__summary" id="manualLessonSummary"></p>
          <ol class="manual-detail__steps" id="manualSteps"></ol>
          <div class="manual-detail__tips" id="manualLessonExtra"></div>
        </article>
      </div>
    </div>
  </div>

  <div id="settingsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
    <div class="modal__content settings-modal">
      <button id="settingsModalClose" class="modal__close" aria-label="Cerrar" data-i18n-aria="modal.closeLabel">&times;</button>
      <h2 id="settingsModalTitle" data-i18n="settings.title">Ajustes</h2>
      <section class="settings-group">
        <h3 data-i18n="settings.appearance">Apariencia</h3>
        <label class="settings-option" for="settingTheme">
          <span data-i18n="settings.theme">Modo de pantalla</span>
          <select id="settingTheme">
            <option value="light" data-i18n="settings.themeOptionLight">Modo d&#237;a</option>
            <option value="dark" data-i18n="settings.themeOptionDark">Modo noche</option>
            <option value="auto" data-i18n="settings.themeOptionAuto">Autom&#225;tico</option>
          </select>
        </label>
      </section>
      <section class="settings-group">
        <h3 data-i18n="settings.language">Idioma</h3>
        <label class="settings-option" for="settingLanguage">
          <span data-i18n="settings.languageLabel">Selecciona un idioma</span>
          <select id="settingLanguage">
            <option value="es" data-i18n="settings.languageOptionEs">Espa&#241;ol</option>
            <option value="en" data-i18n="settings.languageOptionEn">English</option>
          </select>
        </label>
        <p class="settings-helper" data-i18n="settings.languageInfo">Los cambios se aplican de inmediato.</p>
      </section>
      <section class="settings-group">
        <h3 data-i18n="settings.server">Servidor</h3>
        <label class="settings-option" for="settingBackendUrl">
          <span data-i18n="settings.backendUrlLabel">URL del backend</span>
          <input id="settingBackendUrl" type="text" placeholder="http://127.0.0.1:8000">
        </label>
        <div class="settings-actions">
          <button id="saveBackendUrl" type="button" data-i18n="settings.backendSave">Guardar</button>
          <button id="resetBackendUrl" type="button" data-i18n="settings.backendReset">Restaurar por defecto</button>
        </div>
        <p class="settings-helper" id="currentServerLabel"></p>
      </section>
    </div>
  </div>
  <!-- iOS/Safari TTS fallback player -->
  <audio id="ttsPlayer" playsinline muted></audio>
</body>
</html>
